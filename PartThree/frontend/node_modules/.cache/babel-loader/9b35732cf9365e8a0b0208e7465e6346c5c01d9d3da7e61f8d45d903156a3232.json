{"ast":null,"code":"// src/combobox.anatomy.ts\nimport { createAnatomy } from \"@zag-js/anatomy\";\nvar anatomy = createAnatomy(\"combobox\").parts(\"root\", \"clearTrigger\", \"content\", \"control\", \"input\", \"item\", \"itemGroup\", \"itemGroupLabel\", \"itemIndicator\", \"itemText\", \"label\", \"list\", \"positioner\", \"trigger\");\nvar parts = anatomy.build();\n\n// src/combobox.collection.ts\nimport { Collection } from \"@zag-js/collection\";\nimport { ref } from \"@zag-js/core\";\nvar collection = options => {\n  return ref(new Collection(options));\n};\ncollection.empty = () => {\n  return ref(new Collection({\n    items: []\n  }));\n};\n\n// src/combobox.connect.ts\nimport { clickIfLink, getEventKey, isContextMenuEvent, isLeftClick } from \"@zag-js/dom-event\";\nimport { ariaAttr, dataAttr, isComposingEvent, isDownloadingEvent, isOpeningInNewTab } from \"@zag-js/dom-query\";\nimport { getPlacementStyles } from \"@zag-js/popper\";\n\n// src/combobox.dom.ts\nimport { createScope, query } from \"@zag-js/dom-query\";\nvar dom = createScope({\n  getRootId: ctx => ctx.ids?.root ?? `combobox:${ctx.id}`,\n  getLabelId: ctx => ctx.ids?.label ?? `combobox:${ctx.id}:label`,\n  getControlId: ctx => ctx.ids?.control ?? `combobox:${ctx.id}:control`,\n  getInputId: ctx => ctx.ids?.input ?? `combobox:${ctx.id}:input`,\n  getContentId: ctx => ctx.ids?.content ?? `combobox:${ctx.id}:content`,\n  getPositionerId: ctx => ctx.ids?.positioner ?? `combobox:${ctx.id}:popper`,\n  getTriggerId: ctx => ctx.ids?.trigger ?? `combobox:${ctx.id}:toggle-btn`,\n  getClearTriggerId: ctx => ctx.ids?.clearTrigger ?? `combobox:${ctx.id}:clear-btn`,\n  getItemGroupId: (ctx, id) => ctx.ids?.itemGroup?.(id) ?? `combobox:${ctx.id}:optgroup:${id}`,\n  getItemGroupLabelId: (ctx, id) => ctx.ids?.itemGroupLabel?.(id) ?? `combobox:${ctx.id}:optgroup-label:${id}`,\n  getItemId: (ctx, id) => ctx.ids?.item?.(id) ?? `combobox:${ctx.id}:option:${id}`,\n  getContentEl: ctx => dom.getById(ctx, dom.getContentId(ctx)),\n  getInputEl: ctx => dom.getById(ctx, dom.getInputId(ctx)),\n  getPositionerEl: ctx => dom.getById(ctx, dom.getPositionerId(ctx)),\n  getControlEl: ctx => dom.getById(ctx, dom.getControlId(ctx)),\n  getTriggerEl: ctx => dom.getById(ctx, dom.getTriggerId(ctx)),\n  getClearTriggerEl: ctx => dom.getById(ctx, dom.getClearTriggerId(ctx)),\n  getHighlightedItemEl: ctx => {\n    const value = ctx.highlightedValue;\n    if (value == null) return;\n    const selector = `[role=option][data-value=\"${CSS.escape(value)}\"`;\n    return query(dom.getContentEl(ctx), selector);\n  },\n  focusInputEl: ctx => {\n    const inputEl = dom.getInputEl(ctx);\n    if (dom.isActiveElement(ctx, inputEl)) return;\n    inputEl?.focus({\n      preventScroll: true\n    });\n  },\n  focusTriggerEl: ctx => {\n    const triggerEl = dom.getTriggerEl(ctx);\n    if (dom.isActiveElement(ctx, triggerEl)) return;\n    triggerEl?.focus({\n      preventScroll: true\n    });\n  }\n});\n\n// src/combobox.connect.ts\nfunction connect(state, send, normalize) {\n  const translations = state.context.translations;\n  const collection2 = state.context.collection;\n  const disabled = state.context.disabled;\n  const interactive = state.context.isInteractive;\n  const invalid = state.context.invalid;\n  const readOnly = state.context.readOnly;\n  const open = state.hasTag(\"open\");\n  const focused = state.hasTag(\"focused\");\n  const composite = state.context.composite;\n  const highlightedValue = state.context.highlightedValue;\n  const popperStyles = getPlacementStyles({\n    ...state.context.positioning,\n    placement: state.context.currentPlacement\n  });\n  function getItemState(props) {\n    const {\n      item\n    } = props;\n    const disabled2 = collection2.getItemDisabled(item);\n    const value = collection2.getItemValue(item);\n    return {\n      value,\n      disabled: Boolean(disabled2 || disabled2),\n      highlighted: highlightedValue === value,\n      selected: state.context.value.includes(value)\n    };\n  }\n  return {\n    focused,\n    open,\n    inputValue: state.context.inputValue,\n    highlightedValue,\n    highlightedItem: state.context.highlightedItem,\n    value: state.context.value,\n    valueAsString: state.context.valueAsString,\n    hasSelectedItems: state.context.hasSelectedItems,\n    selectedItems: state.context.selectedItems,\n    collection: state.context.collection,\n    reposition(options = {}) {\n      send({\n        type: \"POSITIONING.SET\",\n        options\n      });\n    },\n    setCollection(collection3) {\n      send({\n        type: \"COLLECTION.SET\",\n        value: collection3\n      });\n    },\n    setHighlightValue(value) {\n      send({\n        type: \"HIGHLIGHTED_VALUE.SET\",\n        value\n      });\n    },\n    selectValue(value) {\n      send({\n        type: \"ITEM.SELECT\",\n        value\n      });\n    },\n    setValue(value) {\n      send({\n        type: \"VALUE.SET\",\n        value\n      });\n    },\n    setInputValue(value) {\n      send({\n        type: \"INPUT_VALUE.SET\",\n        value\n      });\n    },\n    clearValue(value) {\n      if (value != null) {\n        send({\n          type: \"ITEM.CLEAR\",\n          value\n        });\n      } else {\n        send(\"VALUE.CLEAR\");\n      }\n    },\n    focus() {\n      dom.getInputEl(state.context)?.focus();\n    },\n    setOpen(nextOpen) {\n      if (nextOpen === open) return;\n      send(nextOpen ? \"OPEN\" : \"CLOSE\");\n    },\n    getRootProps() {\n      return normalize.element({\n        ...parts.root.attrs,\n        dir: state.context.dir,\n        id: dom.getRootId(state.context),\n        \"data-invalid\": dataAttr(invalid),\n        \"data-readonly\": dataAttr(readOnly)\n      });\n    },\n    getLabelProps() {\n      return normalize.label({\n        ...parts.label.attrs,\n        dir: state.context.dir,\n        htmlFor: dom.getInputId(state.context),\n        id: dom.getLabelId(state.context),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-invalid\": dataAttr(invalid),\n        \"data-focus\": dataAttr(focused),\n        onClick(event) {\n          if (composite) return;\n          event.preventDefault();\n          dom.getTriggerEl(state.context)?.focus({\n            preventScroll: true\n          });\n        }\n      });\n    },\n    getControlProps() {\n      return normalize.element({\n        ...parts.control.attrs,\n        dir: state.context.dir,\n        id: dom.getControlId(state.context),\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"data-focus\": dataAttr(focused),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-invalid\": dataAttr(invalid)\n      });\n    },\n    getPositionerProps() {\n      return normalize.element({\n        ...parts.positioner.attrs,\n        dir: state.context.dir,\n        id: dom.getPositionerId(state.context),\n        style: popperStyles.floating\n      });\n    },\n    getInputProps() {\n      return normalize.input({\n        ...parts.input.attrs,\n        dir: state.context.dir,\n        \"aria-invalid\": ariaAttr(invalid),\n        \"data-invalid\": dataAttr(invalid),\n        name: state.context.name,\n        form: state.context.form,\n        disabled,\n        autoFocus: state.context.autoFocus,\n        required: state.context.required,\n        autoComplete: \"off\",\n        autoCorrect: \"off\",\n        autoCapitalize: \"none\",\n        spellCheck: \"false\",\n        readOnly,\n        placeholder: state.context.placeholder,\n        id: dom.getInputId(state.context),\n        type: \"text\",\n        role: \"combobox\",\n        defaultValue: state.context.inputValue,\n        \"aria-autocomplete\": state.context.autoComplete ? \"both\" : \"list\",\n        \"aria-controls\": dom.getContentId(state.context),\n        \"aria-expanded\": open,\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"aria-activedescendant\": highlightedValue ? dom.getItemId(state.context, highlightedValue) : void 0,\n        onClick(event) {\n          if (event.defaultPrevented) return;\n          if (!state.context.openOnClick) return;\n          if (!interactive) return;\n          send(\"INPUT.CLICK\");\n        },\n        onFocus() {\n          if (disabled) return;\n          send(\"INPUT.FOCUS\");\n        },\n        onBlur() {\n          if (disabled) return;\n          send(\"INPUT.BLUR\");\n        },\n        onChange(event) {\n          send({\n            type: \"INPUT.CHANGE\",\n            value: event.currentTarget.value\n          });\n        },\n        onKeyDown(event) {\n          if (event.defaultPrevented) return;\n          if (!interactive) return;\n          if (event.ctrlKey || event.shiftKey || isComposingEvent(event)) return;\n          const openOnKeyPress = state.context.openOnKeyPress;\n          const isModifierKey = event.ctrlKey || event.metaKey || event.shiftKey;\n          const keypress = true;\n          const keymap = {\n            ArrowDown(event2) {\n              if (!openOnKeyPress && !open) return;\n              send({\n                type: event2.altKey ? \"OPEN\" : \"INPUT.ARROW_DOWN\",\n                keypress\n              });\n              event2.preventDefault();\n            },\n            ArrowUp() {\n              if (!openOnKeyPress && !open) return;\n              send({\n                type: event.altKey ? \"CLOSE\" : \"INPUT.ARROW_UP\",\n                keypress\n              });\n              event.preventDefault();\n            },\n            Home(event2) {\n              if (isModifierKey) return;\n              send({\n                type: \"INPUT.HOME\",\n                keypress\n              });\n              if (open) {\n                event2.preventDefault();\n              }\n            },\n            End(event2) {\n              if (isModifierKey) return;\n              send({\n                type: \"INPUT.END\",\n                keypress\n              });\n              if (open) {\n                event2.preventDefault();\n              }\n            },\n            Enter(event2) {\n              send({\n                type: \"INPUT.ENTER\",\n                keypress\n              });\n              if (open) {\n                event2.preventDefault();\n              }\n              const itemEl = dom.getHighlightedItemEl(state.context);\n              clickIfLink(itemEl);\n            },\n            Escape() {\n              send({\n                type: \"INPUT.ESCAPE\",\n                keypress\n              });\n              event.preventDefault();\n            }\n          };\n          const key = getEventKey(event, state.context);\n          const exec = keymap[key];\n          exec?.(event);\n        }\n      });\n    },\n    getTriggerProps(props = {}) {\n      return normalize.button({\n        ...parts.trigger.attrs,\n        dir: state.context.dir,\n        id: dom.getTriggerId(state.context),\n        \"aria-haspopup\": composite ? \"listbox\" : \"dialog\",\n        type: \"button\",\n        tabIndex: props.focusable ? void 0 : -1,\n        \"aria-label\": translations.triggerLabel,\n        \"aria-expanded\": open,\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"aria-controls\": open ? dom.getContentId(state.context) : void 0,\n        disabled,\n        \"data-invalid\": dataAttr(invalid),\n        \"data-focusable\": dataAttr(props.focusable),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-disabled\": dataAttr(disabled),\n        onFocus() {\n          if (!props.focusable) return;\n          send({\n            type: \"INPUT.FOCUS\",\n            src: \"trigger\"\n          });\n        },\n        onClick(event) {\n          if (event.defaultPrevented) return;\n          if (!interactive) return;\n          if (!isLeftClick(event)) return;\n          send(\"TRIGGER.CLICK\");\n        },\n        onPointerDown(event) {\n          if (!interactive) return;\n          if (event.pointerType === \"touch\") return;\n          event.preventDefault();\n          queueMicrotask(() => {\n            dom.getInputEl(state.context)?.focus({\n              preventScroll: true\n            });\n          });\n        },\n        onKeyDown(event) {\n          if (event.defaultPrevented) return;\n          if (composite) return;\n          const keyMap = {\n            ArrowDown() {\n              send({\n                type: \"INPUT.ARROW_DOWN\",\n                src: \"trigger\"\n              });\n            },\n            ArrowUp() {\n              send({\n                type: \"INPUT.ARROW_UP\",\n                src: \"trigger\"\n              });\n            }\n          };\n          const key = getEventKey(event, state.context);\n          const exec = keyMap[key];\n          if (exec) {\n            exec(event);\n            event.preventDefault();\n          }\n        }\n      });\n    },\n    getContentProps() {\n      return normalize.element({\n        ...parts.content.attrs,\n        dir: state.context.dir,\n        id: dom.getContentId(state.context),\n        role: !composite ? \"dialog\" : \"listbox\",\n        tabIndex: -1,\n        hidden: !open,\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"data-placement\": state.context.currentPlacement,\n        \"aria-labelledby\": dom.getLabelId(state.context),\n        \"aria-multiselectable\": state.context.multiple && composite ? true : void 0,\n        onPointerDown(event) {\n          event.preventDefault();\n        }\n      });\n    },\n    getListProps() {\n      return normalize.element({\n        ...parts.list.attrs,\n        role: !composite ? \"listbox\" : void 0,\n        \"aria-labelledby\": dom.getLabelId(state.context),\n        \"aria-multiselectable\": state.context.multiple && !composite ? true : void 0\n      });\n    },\n    getClearTriggerProps() {\n      return normalize.button({\n        ...parts.clearTrigger.attrs,\n        dir: state.context.dir,\n        id: dom.getClearTriggerId(state.context),\n        type: \"button\",\n        tabIndex: -1,\n        disabled,\n        \"data-invalid\": dataAttr(invalid),\n        \"aria-label\": translations.clearTriggerLabel,\n        \"aria-controls\": dom.getInputId(state.context),\n        hidden: !state.context.value.length,\n        onPointerDown(event) {\n          event.preventDefault();\n        },\n        onClick(event) {\n          if (event.defaultPrevented) return;\n          if (!interactive) return;\n          send({\n            type: \"VALUE.CLEAR\",\n            src: \"clear-trigger\"\n          });\n        }\n      });\n    },\n    getItemState,\n    getItemProps(props) {\n      const itemState = getItemState(props);\n      const value = itemState.value;\n      return normalize.element({\n        ...parts.item.attrs,\n        dir: state.context.dir,\n        id: dom.getItemId(state.context, value),\n        role: \"option\",\n        tabIndex: -1,\n        \"data-highlighted\": dataAttr(itemState.highlighted),\n        \"data-state\": itemState.selected ? \"checked\" : \"unchecked\",\n        \"aria-selected\": ariaAttr(itemState.highlighted),\n        \"aria-disabled\": ariaAttr(itemState.disabled),\n        \"data-disabled\": dataAttr(itemState.disabled),\n        \"data-value\": itemState.value,\n        onPointerMove() {\n          if (itemState.disabled) return;\n          if (itemState.highlighted) return;\n          send({\n            type: \"ITEM.POINTER_MOVE\",\n            value\n          });\n        },\n        onPointerLeave() {\n          if (props.persistFocus) return;\n          if (itemState.disabled) return;\n          const mouseMoved = state.previousEvent.type.includes(\"POINTER\");\n          if (!mouseMoved) return;\n          send({\n            type: \"ITEM.POINTER_LEAVE\",\n            value\n          });\n        },\n        onClick(event) {\n          if (isDownloadingEvent(event)) return;\n          if (isOpeningInNewTab(event)) return;\n          if (isContextMenuEvent(event)) return;\n          if (itemState.disabled) return;\n          send({\n            type: \"ITEM.CLICK\",\n            src: \"click\",\n            value\n          });\n        }\n      });\n    },\n    getItemTextProps(props) {\n      const itemState = getItemState(props);\n      return normalize.element({\n        ...parts.itemText.attrs,\n        dir: state.context.dir,\n        \"data-state\": itemState.selected ? \"checked\" : \"unchecked\",\n        \"data-disabled\": dataAttr(itemState.disabled),\n        \"data-highlighted\": dataAttr(itemState.highlighted)\n      });\n    },\n    getItemIndicatorProps(props) {\n      const itemState = getItemState(props);\n      return normalize.element({\n        \"aria-hidden\": true,\n        ...parts.itemIndicator.attrs,\n        dir: state.context.dir,\n        \"data-state\": itemState.selected ? \"checked\" : \"unchecked\",\n        hidden: !itemState.selected\n      });\n    },\n    getItemGroupProps(props) {\n      const {\n        id\n      } = props;\n      return normalize.element({\n        ...parts.itemGroup.attrs,\n        dir: state.context.dir,\n        id: dom.getItemGroupId(state.context, id),\n        \"aria-labelledby\": dom.getItemGroupLabelId(state.context, id)\n      });\n    },\n    getItemGroupLabelProps(props) {\n      const {\n        htmlFor\n      } = props;\n      return normalize.element({\n        ...parts.itemGroupLabel.attrs,\n        dir: state.context.dir,\n        id: dom.getItemGroupLabelId(state.context, htmlFor),\n        role: \"group\"\n      });\n    }\n  };\n}\n\n// src/combobox.machine.ts\nimport { ariaHidden } from \"@zag-js/aria-hidden\";\nimport { createMachine, guards } from \"@zag-js/core\";\nimport { trackDismissableElement } from \"@zag-js/dismissable\";\nimport { observeAttributes, observeChildren, raf, scrollIntoView } from \"@zag-js/dom-query\";\nimport { getPlacement } from \"@zag-js/popper\";\nimport { addOrRemove, compact, isArray, isBoolean, isEqual, match } from \"@zag-js/utils\";\nvar {\n  and,\n  not\n} = guards;\nfunction machine(userContext) {\n  const ctx = compact(userContext);\n  return createMachine({\n    id: \"combobox\",\n    initial: ctx.open ? \"suggesting\" : \"idle\",\n    context: {\n      loopFocus: true,\n      openOnClick: false,\n      value: [],\n      highlightedValue: null,\n      inputValue: \"\",\n      allowCustomValue: false,\n      closeOnSelect: !ctx.multiple,\n      inputBehavior: \"none\",\n      selectionBehavior: \"replace\",\n      openOnKeyPress: true,\n      openOnChange: true,\n      composite: true,\n      readOnly: false,\n      disabled: false,\n      ...ctx,\n      highlightedItem: null,\n      selectedItems: [],\n      valueAsString: \"\",\n      collection: ctx.collection ?? collection.empty(),\n      positioning: {\n        placement: \"bottom\",\n        flip: false,\n        sameWidth: true,\n        ...ctx.positioning\n      },\n      translations: {\n        triggerLabel: \"Toggle suggestions\",\n        clearTriggerLabel: \"Clear value\",\n        ...ctx.translations\n      }\n    },\n    created: [\"syncInitialValues\", \"syncSelectionBehavior\"],\n    computed: {\n      isInputValueEmpty: ctx2 => ctx2.inputValue.length === 0,\n      isInteractive: ctx2 => !(ctx2.readOnly || ctx2.disabled),\n      autoComplete: ctx2 => ctx2.inputBehavior === \"autocomplete\",\n      autoHighlight: ctx2 => ctx2.inputBehavior === \"autohighlight\",\n      hasSelectedItems: ctx2 => ctx2.value.length > 0\n    },\n    watch: {\n      value: [\"syncSelectedItems\"],\n      inputValue: [\"syncInputValue\"],\n      highlightedValue: [\"syncHighlightedItem\", \"autofillInputValue\"],\n      multiple: [\"syncSelectionBehavior\"],\n      open: [\"toggleVisibility\"]\n    },\n    on: {\n      \"HIGHLIGHTED_VALUE.SET\": {\n        actions: [\"setHighlightedItem\"]\n      },\n      \"ITEM.SELECT\": {\n        actions: [\"selectItem\"]\n      },\n      \"ITEM.CLEAR\": {\n        actions: [\"clearItem\"]\n      },\n      \"VALUE.SET\": {\n        actions: [\"setSelectedItems\"]\n      },\n      \"INPUT_VALUE.SET\": {\n        actions: \"setInputValue\"\n      },\n      \"COLLECTION.SET\": {\n        actions: [\"setCollection\"]\n      },\n      \"POSITIONING.SET\": {\n        actions: [\"reposition\"]\n      }\n    },\n    states: {\n      idle: {\n        tags: [\"idle\", \"closed\"],\n        entry: [\"scrollContentToTop\", \"clearHighlightedItem\"],\n        on: {\n          \"CONTROLLED.OPEN\": {\n            target: \"interacting\"\n          },\n          \"TRIGGER.CLICK\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }],\n          \"INPUT.CLICK\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }],\n          \"INPUT.FOCUS\": {\n            target: \"focused\"\n          },\n          OPEN: [{\n            guard: \"isOpenControlled\",\n            actions: [\"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"invokeOnOpen\"]\n          }],\n          \"VALUE.CLEAR\": {\n            target: \"focused\",\n            actions: [\"clearInputValue\", \"clearSelectedItems\", \"setInitialFocus\"]\n          }\n        }\n      },\n      focused: {\n        tags: [\"focused\", \"closed\"],\n        entry: [\"scrollContentToTop\", \"clearHighlightedItem\"],\n        on: {\n          \"CONTROLLED.OPEN\": [{\n            guard: \"isChangeEvent\",\n            target: \"suggesting\"\n          }, {\n            target: \"interacting\"\n          }],\n          \"INPUT.CHANGE\": [{\n            guard: and(\"isOpenControlled\", \"openOnChange\"),\n            actions: [\"setInputValue\", \"invokeOnOpen\", \"highlightFirstItemIfNeeded\"]\n          }, {\n            guard: \"openOnChange\",\n            target: \"suggesting\",\n            actions: [\"setInputValue\", \"invokeOnOpen\", \"highlightFirstItemIfNeeded\"]\n          }, {\n            actions: \"setInputValue\"\n          }],\n          \"LAYER.INTERACT_OUTSIDE\": {\n            target: \"idle\"\n          },\n          \"INPUT.ESCAPE\": {\n            guard: and(\"isCustomValue\", not(\"allowCustomValue\")),\n            actions: \"revertInputValue\"\n          },\n          \"INPUT.BLUR\": {\n            target: \"idle\"\n          },\n          \"INPUT.CLICK\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }],\n          \"TRIGGER.CLICK\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"]\n          }],\n          \"INPUT.ARROW_DOWN\": [\n          // == group 1 ==\n          {\n            guard: and(\"isOpenControlled\", \"autoComplete\"),\n            actions: [\"invokeOnOpen\"]\n          }, {\n            guard: \"autoComplete\",\n            target: \"interacting\",\n            actions: [\"invokeOnOpen\"]\n          },\n          // == group 2 ==\n          {\n            guard: \"isOpenControlled\",\n            actions: [\"highlightFirstOrSelectedItem\", \"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"highlightFirstOrSelectedItem\", \"invokeOnOpen\"]\n          }],\n          \"INPUT.ARROW_UP\": [\n          // == group 1 ==\n          {\n            guard: \"autoComplete\",\n            target: \"interacting\",\n            actions: \"invokeOnOpen\"\n          }, {\n            guard: \"autoComplete\",\n            target: \"interacting\",\n            actions: \"invokeOnOpen\"\n          },\n          // == group 2 ==\n          {\n            target: \"interacting\",\n            actions: [\"highlightLastOrSelectedItem\", \"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"highlightLastOrSelectedItem\", \"invokeOnOpen\"]\n          }],\n          OPEN: [{\n            guard: \"isOpenControlled\",\n            actions: [\"invokeOnOpen\"]\n          }, {\n            target: \"interacting\",\n            actions: [\"invokeOnOpen\"]\n          }],\n          \"VALUE.CLEAR\": {\n            actions: [\"clearInputValue\", \"clearSelectedItems\"]\n          }\n        }\n      },\n      interacting: {\n        tags: [\"open\", \"focused\"],\n        entry: [\"setInitialFocus\"],\n        activities: [\"scrollToHighlightedItem\", \"trackDismissableLayer\", \"computePlacement\", \"hideOtherElements\"],\n        on: {\n          \"CONTROLLED.CLOSE\": [{\n            guard: \"restoreFocus\",\n            target: \"focused\",\n            actions: [\"setFinalFocus\"]\n          }, {\n            target: \"idle\"\n          }],\n          \"INPUT.HOME\": {\n            actions: [\"highlightFirstItem\"]\n          },\n          \"INPUT.END\": {\n            actions: [\"highlightLastItem\"]\n          },\n          \"INPUT.ARROW_DOWN\": [{\n            guard: and(\"autoComplete\", \"isLastItemHighlighted\"),\n            actions: [\"clearHighlightedItem\", \"scrollContentToTop\"]\n          }, {\n            actions: [\"highlightNextItem\"]\n          }],\n          \"INPUT.ARROW_UP\": [{\n            guard: and(\"autoComplete\", \"isFirstItemHighlighted\"),\n            actions: \"clearHighlightedItem\"\n          }, {\n            actions: \"highlightPrevItem\"\n          }],\n          \"INPUT.ENTER\": [{\n            guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n            actions: [\"selectHighlightedItem\", \"invokeOnClose\"]\n          }, {\n            guard: \"closeOnSelect\",\n            target: \"focused\",\n            actions: [\"selectHighlightedItem\", \"invokeOnClose\", \"setFinalFocus\"]\n          }, {\n            actions: [\"selectHighlightedItem\"]\n          }],\n          \"INPUT.CHANGE\": [{\n            guard: \"autoComplete\",\n            target: \"suggesting\",\n            actions: [\"setInputValue\", \"invokeOnOpen\"]\n          }, {\n            target: \"suggesting\",\n            actions: [\"clearHighlightedItem\", \"setInputValue\", \"invokeOnOpen\"]\n          }],\n          \"ITEM.POINTER_MOVE\": {\n            actions: [\"setHighlightedItem\"]\n          },\n          \"ITEM.POINTER_LEAVE\": {\n            actions: [\"clearHighlightedItem\"]\n          },\n          \"ITEM.CLICK\": [{\n            guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n            actions: [\"selectItem\", \"invokeOnClose\"]\n          }, {\n            guard: \"closeOnSelect\",\n            target: \"focused\",\n            actions: [\"selectItem\", \"invokeOnClose\", \"setFinalFocus\"]\n          }, {\n            actions: [\"selectItem\"]\n          }],\n          \"LAYER.ESCAPE\": [{\n            guard: and(\"isOpenControlled\", \"autoComplete\"),\n            actions: [\"syncInputValue\", \"invokeOnClose\"]\n          }, {\n            guard: \"autoComplete\",\n            target: \"focused\",\n            actions: [\"syncInputValue\", \"invokeOnClose\"]\n          }, {\n            guard: \"isOpenControlled\",\n            actions: \"invokeOnClose\"\n          }, {\n            target: \"focused\",\n            actions: [\"invokeOnClose\", \"setFinalFocus\"]\n          }],\n          \"TRIGGER.CLICK\": [{\n            guard: \"isOpenControlled\",\n            actions: \"invokeOnClose\"\n          }, {\n            target: \"focused\",\n            actions: \"invokeOnClose\"\n          }],\n          \"LAYER.INTERACT_OUTSIDE\": [\n          // == group 1 ==\n          {\n            guard: and(\"isOpenControlled\", \"isCustomValue\", not(\"allowCustomValue\")),\n            actions: [\"revertInputValue\", \"invokeOnClose\"]\n          }, {\n            guard: and(\"isCustomValue\", not(\"allowCustomValue\")),\n            target: \"idle\",\n            actions: [\"revertInputValue\", \"invokeOnClose\"]\n          },\n          // == group 2 ==\n          {\n            guard: \"isOpenControlled\",\n            actions: \"invokeOnClose\"\n          }, {\n            target: \"idle\",\n            actions: \"invokeOnClose\"\n          }],\n          CLOSE: [{\n            guard: \"isOpenControlled\",\n            actions: [\"invokeOnClose\"]\n          }, {\n            target: \"focused\",\n            actions: [\"invokeOnClose\", \"setFinalFocus\"]\n          }],\n          \"VALUE.CLEAR\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\"]\n          }, {\n            target: \"focused\",\n            actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\", \"setFinalFocus\"]\n          }]\n        }\n      },\n      suggesting: {\n        tags: [\"open\", \"focused\"],\n        activities: [\"trackDismissableLayer\", \"scrollToHighlightedItem\", \"computePlacement\", \"trackChildNodes\", \"hideOtherElements\"],\n        entry: [\"setInitialFocus\"],\n        on: {\n          \"CONTROLLED.CLOSE\": [{\n            guard: \"restoreFocus\",\n            target: \"focused\",\n            actions: [\"setFinalFocus\"]\n          }, {\n            target: \"idle\"\n          }],\n          CHILDREN_CHANGE: {\n            actions: [\"highlightFirstItem\"]\n          },\n          \"INPUT.ARROW_DOWN\": {\n            target: \"interacting\",\n            actions: [\"highlightNextItem\"]\n          },\n          \"INPUT.ARROW_UP\": {\n            target: \"interacting\",\n            actions: [\"highlightPrevItem\"]\n          },\n          \"INPUT.HOME\": {\n            target: \"interacting\",\n            actions: [\"highlightFirstItem\"]\n          },\n          \"INPUT.END\": {\n            target: \"interacting\",\n            actions: [\"highlightLastItem\"]\n          },\n          \"INPUT.ENTER\": [{\n            guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n            actions: [\"selectHighlightedItem\", \"invokeOnClose\"]\n          }, {\n            guard: \"closeOnSelect\",\n            target: \"focused\",\n            actions: [\"selectHighlightedItem\", \"invokeOnClose\", \"setFinalFocus\"]\n          }, {\n            actions: [\"selectHighlightedItem\"]\n          }],\n          \"INPUT.CHANGE\": [{\n            guard: \"autoHighlight\",\n            actions: [\"setInputValue\"]\n          }, {\n            actions: [\"setInputValue\"]\n          }],\n          \"LAYER.ESCAPE\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"invokeOnClose\"]\n          }, {\n            target: \"focused\",\n            actions: [\"invokeOnClose\"]\n          }],\n          \"ITEM.POINTER_MOVE\": {\n            target: \"interacting\",\n            actions: [\"setHighlightedItem\"]\n          },\n          \"ITEM.POINTER_LEAVE\": {\n            actions: [\"clearHighlightedItem\"]\n          },\n          \"LAYER.INTERACT_OUTSIDE\": [\n          // == group 1 ==\n          {\n            guard: and(\"isOpenControlled\", \"isCustomValue\", not(\"allowCustomValue\")),\n            actions: [\"revertInputValue\", \"invokeOnClose\"]\n          }, {\n            guard: and(\"isCustomValue\", not(\"allowCustomValue\")),\n            target: \"idle\",\n            actions: [\"revertInputValue\", \"invokeOnClose\"]\n          },\n          // == group 2 ==\n          {\n            guard: \"isOpenControlled\",\n            actions: [\"invokeOnClose\"]\n          }, {\n            target: \"idle\",\n            actions: [\"invokeOnClose\"]\n          }],\n          \"TRIGGER.CLICK\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"invokeOnClose\"]\n          }, {\n            target: \"focused\",\n            actions: [\"invokeOnClose\"]\n          }],\n          \"ITEM.CLICK\": [{\n            guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n            actions: [\"selectItem\", \"invokeOnClose\"]\n          }, {\n            guard: \"closeOnSelect\",\n            target: \"focused\",\n            actions: [\"selectItem\", \"invokeOnClose\", \"setFinalFocus\"]\n          }, {\n            actions: [\"selectItem\"]\n          }],\n          CLOSE: [{\n            guard: \"isOpenControlled\",\n            actions: [\"invokeOnClose\"]\n          }, {\n            target: \"focused\",\n            actions: [\"invokeOnClose\", \"setFinalFocus\"]\n          }],\n          \"VALUE.CLEAR\": [{\n            guard: \"isOpenControlled\",\n            actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\"]\n          }, {\n            target: \"focused\",\n            actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\", \"setFinalFocus\"]\n          }]\n        }\n      }\n    }\n  }, {\n    guards: {\n      isInputValueEmpty: ctx2 => ctx2.isInputValueEmpty,\n      autoComplete: ctx2 => ctx2.autoComplete && !ctx2.multiple,\n      autoHighlight: ctx2 => ctx2.autoHighlight,\n      isFirstItemHighlighted: ctx2 => ctx2.collection.firstValue === ctx2.highlightedValue,\n      isLastItemHighlighted: ctx2 => ctx2.collection.lastValue === ctx2.highlightedValue,\n      isCustomValue: ctx2 => ctx2.inputValue !== ctx2.valueAsString,\n      allowCustomValue: ctx2 => !!ctx2.allowCustomValue,\n      hasHighlightedItem: ctx2 => ctx2.highlightedValue != null,\n      closeOnSelect: ctx2 => !!ctx2.closeOnSelect,\n      isOpenControlled: ctx2 => !!ctx2[\"open.controlled\"],\n      openOnChange: (ctx2, evt) => {\n        if (isBoolean(ctx2.openOnChange)) return ctx2.openOnChange;\n        return !!ctx2.openOnChange?.({\n          inputValue: evt.value\n        });\n      },\n      restoreFocus: (_ctx, evt) => evt.restoreFocus == null ? true : !!evt.restoreFocus,\n      isChangeEvent: (_ctx, evt) => evt.previousEvent?.type === \"INPUT.CHANGE\"\n    },\n    activities: {\n      trackDismissableLayer(ctx2, _evt, {\n        send\n      }) {\n        if (ctx2.disableLayer) return;\n        const contentEl = () => dom.getContentEl(ctx2);\n        return trackDismissableElement(contentEl, {\n          defer: true,\n          exclude: () => [dom.getInputEl(ctx2), dom.getTriggerEl(ctx2), dom.getClearTriggerEl(ctx2)],\n          onFocusOutside: ctx2.onFocusOutside,\n          onPointerDownOutside: ctx2.onPointerDownOutside,\n          onInteractOutside: ctx2.onInteractOutside,\n          onEscapeKeyDown(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            send(\"LAYER.ESCAPE\");\n          },\n          onDismiss() {\n            send({\n              type: \"LAYER.INTERACT_OUTSIDE\",\n              restoreFocus: false\n            });\n          }\n        });\n      },\n      hideOtherElements(ctx2) {\n        return ariaHidden([dom.getInputEl(ctx2), dom.getContentEl(ctx2), dom.getTriggerEl(ctx2)]);\n      },\n      computePlacement(ctx2) {\n        const controlEl = () => dom.getControlEl(ctx2);\n        const positionerEl = () => dom.getPositionerEl(ctx2);\n        ctx2.currentPlacement = ctx2.positioning.placement;\n        return getPlacement(controlEl, positionerEl, {\n          ...ctx2.positioning,\n          defer: true,\n          onComplete(data) {\n            ctx2.currentPlacement = data.placement;\n          }\n        });\n      },\n      // in event the options are fetched (async), we still want to auto-highlight the first option\n      trackChildNodes(ctx2, _evt, {\n        send\n      }) {\n        if (!ctx2.autoHighlight) return;\n        const exec = () => send(\"CHILDREN_CHANGE\");\n        const contentEl = () => dom.getContentEl(ctx2);\n        return observeChildren(contentEl, {\n          callback: exec,\n          defer: true\n        });\n      },\n      scrollToHighlightedItem(ctx2, _evt, {\n        getState\n      }) {\n        const inputEl = dom.getInputEl(ctx2);\n        let cleanups = [];\n        const exec = immediate => {\n          const state = getState();\n          const pointer = state.event.type.includes(\"POINTER\");\n          if (pointer || !ctx2.highlightedValue) return;\n          const itemEl = dom.getHighlightedItemEl(ctx2);\n          const contentEl = dom.getContentEl(ctx2);\n          if (ctx2.scrollToIndexFn) {\n            const highlightedIndex = ctx2.collection.indexOf(ctx2.highlightedValue);\n            ctx2.scrollToIndexFn({\n              index: highlightedIndex,\n              immediate\n            });\n            return;\n          }\n          const rafCleanup2 = raf(() => {\n            scrollIntoView(itemEl, {\n              rootEl: contentEl,\n              block: \"nearest\"\n            });\n          });\n          cleanups.push(rafCleanup2);\n        };\n        const rafCleanup = raf(() => exec(true));\n        cleanups.push(rafCleanup);\n        const observerCleanup = observeAttributes(inputEl, {\n          attributes: [\"aria-activedescendant\"],\n          callback: () => exec(false)\n        });\n        cleanups.push(observerCleanup);\n        return () => {\n          cleanups.forEach(cleanup => cleanup());\n        };\n      }\n    },\n    actions: {\n      reposition(ctx2, evt) {\n        const controlEl = () => dom.getControlEl(ctx2);\n        const positionerEl = () => dom.getPositionerEl(ctx2);\n        getPlacement(controlEl, positionerEl, {\n          ...ctx2.positioning,\n          ...evt.options,\n          defer: true,\n          listeners: false,\n          onComplete(data) {\n            ctx2.currentPlacement = data.placement;\n          }\n        });\n      },\n      setHighlightedItem(ctx2, evt) {\n        if (evt.value == null) return;\n        set.highlightedValue(ctx2, evt.value);\n      },\n      clearHighlightedItem(ctx2) {\n        set.highlightedValue(ctx2, null, true);\n      },\n      selectHighlightedItem(ctx2) {\n        set.value(ctx2, ctx2.highlightedValue);\n      },\n      selectItem(ctx2, evt) {\n        if (evt.value == null) return;\n        set.value(ctx2, evt.value);\n      },\n      clearItem(ctx2, evt) {\n        if (evt.value == null) return;\n        const value = ctx2.value.filter(v => v !== evt.value);\n        set.value(ctx2, value);\n      },\n      setInitialFocus(ctx2) {\n        raf(() => {\n          dom.focusInputEl(ctx2);\n        });\n      },\n      setFinalFocus(ctx2) {\n        raf(() => {\n          const triggerEl = dom.getTriggerEl(ctx2);\n          if (triggerEl?.dataset.focusable == null) {\n            dom.focusInputEl(ctx2);\n          } else {\n            dom.focusTriggerEl(ctx2);\n          }\n        });\n      },\n      syncInputValue(ctx2) {\n        const inputEl = dom.getInputEl(ctx2);\n        if (!inputEl) return;\n        inputEl.value = ctx2.inputValue;\n        queueMicrotask(() => {\n          const {\n            selectionStart,\n            selectionEnd\n          } = inputEl;\n          if (Math.abs((selectionEnd ?? 0) - (selectionStart ?? 0)) !== 0) return;\n          if (selectionStart !== 0) return;\n          inputEl.setSelectionRange(inputEl.value.length, inputEl.value.length);\n        });\n      },\n      setInputValue(ctx2, evt) {\n        set.inputValue(ctx2, evt.value);\n      },\n      clearInputValue(ctx2) {\n        set.inputValue(ctx2, \"\");\n      },\n      revertInputValue(ctx2) {\n        const inputValue = match(ctx2.selectionBehavior, {\n          replace: ctx2.hasSelectedItems ? ctx2.valueAsString : \"\",\n          preserve: ctx2.inputValue,\n          clear: \"\"\n        });\n        set.inputValue(ctx2, inputValue);\n      },\n      syncInitialValues(ctx2) {\n        const selectedItems = ctx2.collection.findMany(ctx2.value);\n        const valueAsString = ctx2.collection.stringifyMany(ctx2.value);\n        ctx2.highlightedItem = ctx2.collection.find(ctx2.highlightedValue);\n        ctx2.selectedItems = selectedItems;\n        ctx2.valueAsString = valueAsString;\n        if (ctx2.inputValue.trim() || ctx2.multiple) return;\n        ctx2.inputValue = match(ctx2.selectionBehavior, {\n          preserve: ctx2.inputValue || valueAsString,\n          replace: valueAsString,\n          clear: \"\"\n        });\n      },\n      syncSelectionBehavior(ctx2) {\n        if (ctx2.multiple) {\n          ctx2.selectionBehavior = \"clear\";\n        }\n      },\n      setSelectedItems(ctx2, evt) {\n        if (!isArray(evt.value)) return;\n        set.value(ctx2, evt.value);\n      },\n      clearSelectedItems(ctx2) {\n        set.value(ctx2, []);\n      },\n      scrollContentToTop(ctx2) {\n        if (ctx2.scrollToIndexFn) {\n          ctx2.scrollToIndexFn({\n            index: 0,\n            immediate: true\n          });\n        } else {\n          const contentEl = dom.getContentEl(ctx2);\n          if (!contentEl) return;\n          contentEl.scrollTop = 0;\n        }\n      },\n      invokeOnOpen(ctx2) {\n        ctx2.onOpenChange?.({\n          open: true\n        });\n      },\n      invokeOnClose(ctx2) {\n        ctx2.onOpenChange?.({\n          open: false\n        });\n      },\n      highlightFirstItem(ctx2) {\n        raf(() => {\n          const value = ctx2.collection.firstValue;\n          set.highlightedValue(ctx2, value);\n        });\n      },\n      highlightFirstItemIfNeeded(ctx2) {\n        if (!ctx2.autoHighlight) return;\n        raf(() => {\n          const value = ctx2.collection.firstValue;\n          set.highlightedValue(ctx2, value);\n        });\n      },\n      highlightLastItem(ctx2) {\n        raf(() => {\n          const value = ctx2.collection.lastValue;\n          set.highlightedValue(ctx2, value);\n        });\n      },\n      highlightNextItem(ctx2) {\n        let value = null;\n        if (ctx2.highlightedValue) {\n          value = ctx2.collection.getNextValue(ctx2.highlightedValue);\n          if (!value && ctx2.loopFocus) value = ctx2.collection.firstValue;\n        } else {\n          value = ctx2.collection.firstValue;\n        }\n        set.highlightedValue(ctx2, value);\n      },\n      highlightPrevItem(ctx2) {\n        let value = null;\n        if (ctx2.highlightedValue) {\n          value = ctx2.collection.getPreviousValue(ctx2.highlightedValue);\n          if (!value && ctx2.loopFocus) value = ctx2.collection.lastValue;\n        } else {\n          value = ctx2.collection.lastValue;\n        }\n        set.highlightedValue(ctx2, value);\n      },\n      highlightFirstSelectedItem(ctx2) {\n        raf(() => {\n          const [value] = ctx2.collection.sort(ctx2.value);\n          set.highlightedValue(ctx2, value);\n        });\n      },\n      highlightFirstOrSelectedItem(ctx2) {\n        raf(() => {\n          let value = null;\n          if (ctx2.hasSelectedItems) {\n            value = ctx2.collection.sort(ctx2.value)[0];\n          } else {\n            value = ctx2.collection.firstValue;\n          }\n          set.highlightedValue(ctx2, value);\n        });\n      },\n      highlightLastOrSelectedItem(ctx2) {\n        raf(() => {\n          let value = null;\n          if (ctx2.hasSelectedItems) {\n            value = ctx2.collection.sort(ctx2.value)[0];\n          } else {\n            value = ctx2.collection.lastValue;\n          }\n          set.highlightedValue(ctx2, value);\n        });\n      },\n      autofillInputValue(ctx2, evt) {\n        const inputEl = dom.getInputEl(ctx2);\n        if (!ctx2.autoComplete || !inputEl || !evt.keypress) return;\n        const valueText = ctx2.collection.stringify(ctx2.highlightedValue);\n        raf(() => {\n          inputEl.value = valueText || ctx2.inputValue;\n        });\n      },\n      setCollection(ctx2, evt) {\n        ctx2.collection = evt.value;\n      },\n      syncSelectedItems(ctx2) {\n        sync.valueChange(ctx2);\n      },\n      syncHighlightedItem(ctx2) {\n        sync.highlightChange(ctx2);\n      },\n      toggleVisibility(ctx2, evt, {\n        send\n      }) {\n        send({\n          type: ctx2.open ? \"CONTROLLED.OPEN\" : \"CONTROLLED.CLOSE\",\n          previousEvent: evt\n        });\n      }\n    }\n  });\n}\nvar sync = {\n  valueChange: ctx => {\n    const prevSelectedItems = ctx.selectedItems;\n    ctx.selectedItems = ctx.value.map(v => {\n      const foundItem = prevSelectedItems.find(item => ctx.collection.getItemValue(item) === v);\n      if (foundItem) return foundItem;\n      return ctx.collection.find(v);\n    });\n    const valueAsString = ctx.collection.stringifyItems(ctx.selectedItems);\n    ctx.valueAsString = valueAsString;\n    let inputValue;\n    if (ctx.getSelectionValue) {\n      inputValue = ctx.getSelectionValue({\n        inputValue: ctx.inputValue,\n        selectedItems: Array.from(ctx.selectedItems),\n        valueAsString\n      });\n    } else {\n      inputValue = match(ctx.selectionBehavior, {\n        replace: ctx.valueAsString,\n        preserve: ctx.inputValue,\n        clear: \"\"\n      });\n    }\n    set.inputValue(ctx, inputValue);\n  },\n  highlightChange: ctx => {\n    ctx.highlightedItem = ctx.collection.find(ctx.highlightedValue);\n  }\n};\nvar invoke = {\n  valueChange: ctx => {\n    sync.valueChange(ctx);\n    ctx.onValueChange?.({\n      value: Array.from(ctx.value),\n      items: Array.from(ctx.selectedItems)\n    });\n  },\n  highlightChange: ctx => {\n    sync.highlightChange(ctx);\n    ctx.onHighlightChange?.({\n      highlightedValue: ctx.highlightedValue,\n      highlightedItem: ctx.highlightedItem\n    });\n  },\n  inputChange: ctx => {\n    ctx.onInputValueChange?.({\n      inputValue: ctx.inputValue\n    });\n  }\n};\nvar set = {\n  value: (ctx, value, force = false) => {\n    if (isEqual(ctx.value, value)) return;\n    if (value == null && !force) return;\n    if (value == null && force) {\n      ctx.value = [];\n      invoke.valueChange(ctx);\n      return;\n    }\n    if (isArray(value)) {\n      ctx.value = value;\n    } else if (value != null) {\n      ctx.value = ctx.multiple ? addOrRemove(ctx.value, value) : [value];\n    }\n    invoke.valueChange(ctx);\n  },\n  highlightedValue: (ctx, value, force = false) => {\n    if (isEqual(ctx.highlightedValue, value)) return;\n    if (!value && !force) return;\n    ctx.highlightedValue = value || null;\n    invoke.highlightChange(ctx);\n  },\n  inputValue: (ctx, value) => {\n    if (isEqual(ctx.inputValue, value)) return;\n    ctx.inputValue = value;\n    invoke.inputChange(ctx);\n  }\n};\nexport { anatomy, collection, connect, machine };","map":{"version":3,"names":["createAnatomy","anatomy","parts","build","Collection","ref","collection","options","empty","items","clickIfLink","getEventKey","isContextMenuEvent","isLeftClick","ariaAttr","dataAttr","isComposingEvent","isDownloadingEvent","isOpeningInNewTab","getPlacementStyles","createScope","query","dom","getRootId","ctx","ids","root","id","getLabelId","label","getControlId","control","getInputId","input","getContentId","content","getPositionerId","positioner","getTriggerId","trigger","getClearTriggerId","clearTrigger","getItemGroupId","itemGroup","getItemGroupLabelId","itemGroupLabel","getItemId","item","getContentEl","getById","getInputEl","getPositionerEl","getControlEl","getTriggerEl","getClearTriggerEl","getHighlightedItemEl","value","highlightedValue","selector","CSS","escape","focusInputEl","inputEl","isActiveElement","focus","preventScroll","focusTriggerEl","triggerEl","connect","state","send","normalize","translations","context","collection2","disabled","interactive","isInteractive","invalid","readOnly","open","hasTag","focused","composite","popperStyles","positioning","placement","currentPlacement","getItemState","props","disabled2","getItemDisabled","getItemValue","Boolean","highlighted","selected","includes","inputValue","highlightedItem","valueAsString","hasSelectedItems","selectedItems","reposition","type","setCollection","collection3","setHighlightValue","selectValue","setValue","setInputValue","clearValue","setOpen","nextOpen","getRootProps","element","attrs","dir","getLabelProps","htmlFor","onClick","event","preventDefault","getControlProps","getPositionerProps","style","floating","getInputProps","name","form","autoFocus","required","autoComplete","autoCorrect","autoCapitalize","spellCheck","placeholder","role","defaultValue","defaultPrevented","openOnClick","onFocus","onBlur","onChange","currentTarget","onKeyDown","ctrlKey","shiftKey","openOnKeyPress","isModifierKey","metaKey","keypress","keymap","ArrowDown","event2","altKey","ArrowUp","Home","End","Enter","itemEl","Escape","key","exec","getTriggerProps","button","tabIndex","focusable","triggerLabel","src","onPointerDown","pointerType","queueMicrotask","keyMap","getContentProps","hidden","multiple","getListProps","list","getClearTriggerProps","clearTriggerLabel","length","getItemProps","itemState","onPointerMove","onPointerLeave","persistFocus","mouseMoved","previousEvent","getItemTextProps","itemText","getItemIndicatorProps","itemIndicator","getItemGroupProps","getItemGroupLabelProps","ariaHidden","createMachine","guards","trackDismissableElement","observeAttributes","observeChildren","raf","scrollIntoView","getPlacement","addOrRemove","compact","isArray","isBoolean","isEqual","match","and","not","machine","userContext","initial","loopFocus","allowCustomValue","closeOnSelect","inputBehavior","selectionBehavior","openOnChange","flip","sameWidth","created","computed","isInputValueEmpty","ctx2","autoHighlight","watch","on","actions","states","idle","tags","entry","target","guard","OPEN","interacting","activities","CLOSE","suggesting","CHILDREN_CHANGE","isFirstItemHighlighted","firstValue","isLastItemHighlighted","lastValue","isCustomValue","hasHighlightedItem","isOpenControlled","evt","restoreFocus","_ctx","isChangeEvent","trackDismissableLayer","_evt","disableLayer","contentEl","defer","exclude","onFocusOutside","onPointerDownOutside","onInteractOutside","onEscapeKeyDown","stopPropagation","onDismiss","hideOtherElements","computePlacement","controlEl","positionerEl","onComplete","data","trackChildNodes","callback","scrollToHighlightedItem","getState","cleanups","immediate","pointer","scrollToIndexFn","highlightedIndex","indexOf","index","rafCleanup2","rootEl","block","push","rafCleanup","observerCleanup","attributes","forEach","cleanup","listeners","setHighlightedItem","set","clearHighlightedItem","selectHighlightedItem","selectItem","clearItem","filter","v","setInitialFocus","setFinalFocus","dataset","syncInputValue","selectionStart","selectionEnd","Math","abs","setSelectionRange","clearInputValue","revertInputValue","replace","preserve","clear","syncInitialValues","findMany","stringifyMany","find","trim","syncSelectionBehavior","setSelectedItems","clearSelectedItems","scrollContentToTop","scrollTop","invokeOnOpen","onOpenChange","invokeOnClose","highlightFirstItem","highlightFirstItemIfNeeded","highlightLastItem","highlightNextItem","getNextValue","highlightPrevItem","getPreviousValue","highlightFirstSelectedItem","sort","highlightFirstOrSelectedItem","highlightLastOrSelectedItem","autofillInputValue","valueText","stringify","syncSelectedItems","sync","valueChange","syncHighlightedItem","highlightChange","toggleVisibility","prevSelectedItems","map","foundItem","stringifyItems","getSelectionValue","Array","from","invoke","onValueChange","onHighlightChange","inputChange","onInputValueChange","force"],"sources":["C:\\Users\\lab_services_student\\Desktop\\PartThree\\frontend\\node_modules\\@zag-js\\combobox\\src\\combobox.anatomy.ts","C:\\Users\\lab_services_student\\Desktop\\PartThree\\frontend\\node_modules\\@zag-js\\combobox\\src\\combobox.collection.ts","C:\\Users\\lab_services_student\\Desktop\\PartThree\\frontend\\node_modules\\@zag-js\\combobox\\src\\combobox.connect.ts","C:\\Users\\lab_services_student\\Desktop\\PartThree\\frontend\\node_modules\\@zag-js\\combobox\\src\\combobox.dom.ts","C:\\Users\\lab_services_student\\Desktop\\PartThree\\frontend\\node_modules\\@zag-js\\combobox\\src\\combobox.machine.ts"],"sourcesContent":["import { createAnatomy } from \"@zag-js/anatomy\"\n\nexport const anatomy = createAnatomy(\"combobox\").parts(\n  \"root\",\n  \"clearTrigger\",\n  \"content\",\n  \"control\",\n  \"input\",\n  \"item\",\n  \"itemGroup\",\n  \"itemGroupLabel\",\n  \"itemIndicator\",\n  \"itemText\",\n  \"label\",\n  \"list\",\n  \"positioner\",\n  \"trigger\",\n)\nexport const parts = anatomy.build()\n","import { Collection, type CollectionItem, type CollectionOptions } from \"@zag-js/collection\"\nimport { ref } from \"@zag-js/core\"\n\nexport const collection = <T extends CollectionItem>(options: CollectionOptions<T>): Collection<T> => {\n  return ref(new Collection(options))\n}\n\ncollection.empty = (): Collection<CollectionItem> => {\n  return ref(new Collection<CollectionItem>({ items: [] }))\n}\n","import { clickIfLink, getEventKey, isContextMenuEvent, isLeftClick, type EventKeyMap } from \"@zag-js/dom-event\"\nimport { ariaAttr, dataAttr, isComposingEvent, isDownloadingEvent, isOpeningInNewTab } from \"@zag-js/dom-query\"\nimport { getPlacementStyles } from \"@zag-js/popper\"\nimport type { NormalizeProps, PropTypes } from \"@zag-js/types\"\nimport { parts } from \"./combobox.anatomy\"\nimport { dom } from \"./combobox.dom\"\nimport type { CollectionItem, ItemProps, ItemState, MachineApi, Send, State } from \"./combobox.types\"\n\nexport function connect<T extends PropTypes, V extends CollectionItem>(\n  state: State,\n  send: Send,\n  normalize: NormalizeProps<T>,\n): MachineApi<T, V> {\n  const translations = state.context.translations\n  const collection = state.context.collection\n\n  const disabled = state.context.disabled\n  const interactive = state.context.isInteractive\n  const invalid = state.context.invalid\n  const readOnly = state.context.readOnly\n\n  const open = state.hasTag(\"open\")\n  const focused = state.hasTag(\"focused\")\n  const composite = state.context.composite\n  const highlightedValue = state.context.highlightedValue\n\n  const popperStyles = getPlacementStyles({\n    ...state.context.positioning,\n    placement: state.context.currentPlacement,\n  })\n\n  function getItemState(props: ItemProps): ItemState {\n    const { item } = props\n    const disabled = collection.getItemDisabled(item)\n    const value = collection.getItemValue(item)!\n    return {\n      value,\n      disabled: Boolean(disabled || disabled),\n      highlighted: highlightedValue === value,\n      selected: state.context.value.includes(value),\n    }\n  }\n\n  return {\n    focused,\n    open,\n    inputValue: state.context.inputValue,\n    highlightedValue,\n    highlightedItem: state.context.highlightedItem,\n    value: state.context.value,\n    valueAsString: state.context.valueAsString,\n    hasSelectedItems: state.context.hasSelectedItems,\n    selectedItems: state.context.selectedItems,\n    collection: state.context.collection,\n    reposition(options = {}) {\n      send({ type: \"POSITIONING.SET\", options })\n    },\n    setCollection(collection) {\n      send({ type: \"COLLECTION.SET\", value: collection })\n    },\n    setHighlightValue(value) {\n      send({ type: \"HIGHLIGHTED_VALUE.SET\", value })\n    },\n    selectValue(value) {\n      send({ type: \"ITEM.SELECT\", value })\n    },\n    setValue(value) {\n      send({ type: \"VALUE.SET\", value })\n    },\n    setInputValue(value) {\n      send({ type: \"INPUT_VALUE.SET\", value })\n    },\n    clearValue(value) {\n      if (value != null) {\n        send({ type: \"ITEM.CLEAR\", value })\n      } else {\n        send(\"VALUE.CLEAR\")\n      }\n    },\n    focus() {\n      dom.getInputEl(state.context)?.focus()\n    },\n    setOpen(nextOpen) {\n      if (nextOpen === open) return\n      send(nextOpen ? \"OPEN\" : \"CLOSE\")\n    },\n\n    getRootProps() {\n      return normalize.element({\n        ...parts.root.attrs,\n        dir: state.context.dir,\n        id: dom.getRootId(state.context),\n        \"data-invalid\": dataAttr(invalid),\n        \"data-readonly\": dataAttr(readOnly),\n      })\n    },\n\n    getLabelProps() {\n      return normalize.label({\n        ...parts.label.attrs,\n        dir: state.context.dir,\n        htmlFor: dom.getInputId(state.context),\n        id: dom.getLabelId(state.context),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-invalid\": dataAttr(invalid),\n        \"data-focus\": dataAttr(focused),\n        onClick(event) {\n          if (composite) return\n          event.preventDefault()\n          dom.getTriggerEl(state.context)?.focus({ preventScroll: true })\n        },\n      })\n    },\n\n    getControlProps() {\n      return normalize.element({\n        ...parts.control.attrs,\n        dir: state.context.dir,\n        id: dom.getControlId(state.context),\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"data-focus\": dataAttr(focused),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-invalid\": dataAttr(invalid),\n      })\n    },\n\n    getPositionerProps() {\n      return normalize.element({\n        ...parts.positioner.attrs,\n        dir: state.context.dir,\n        id: dom.getPositionerId(state.context),\n        style: popperStyles.floating,\n      })\n    },\n\n    getInputProps() {\n      return normalize.input({\n        ...parts.input.attrs,\n        dir: state.context.dir,\n        \"aria-invalid\": ariaAttr(invalid),\n        \"data-invalid\": dataAttr(invalid),\n        name: state.context.name,\n        form: state.context.form,\n        disabled: disabled,\n        autoFocus: state.context.autoFocus,\n        required: state.context.required,\n        autoComplete: \"off\",\n        autoCorrect: \"off\",\n        autoCapitalize: \"none\",\n        spellCheck: \"false\",\n        readOnly: readOnly,\n        placeholder: state.context.placeholder,\n        id: dom.getInputId(state.context),\n        type: \"text\",\n        role: \"combobox\",\n        defaultValue: state.context.inputValue,\n        \"aria-autocomplete\": state.context.autoComplete ? \"both\" : \"list\",\n        \"aria-controls\": dom.getContentId(state.context),\n        \"aria-expanded\": open,\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"aria-activedescendant\": highlightedValue ? dom.getItemId(state.context, highlightedValue) : undefined,\n        onClick(event) {\n          if (event.defaultPrevented) return\n          if (!state.context.openOnClick) return\n          if (!interactive) return\n          send(\"INPUT.CLICK\")\n        },\n        onFocus() {\n          if (disabled) return\n          send(\"INPUT.FOCUS\")\n        },\n        onBlur() {\n          if (disabled) return\n          send(\"INPUT.BLUR\")\n        },\n        onChange(event) {\n          send({ type: \"INPUT.CHANGE\", value: event.currentTarget.value })\n        },\n        onKeyDown(event) {\n          if (event.defaultPrevented) return\n          if (!interactive) return\n\n          if (event.ctrlKey || event.shiftKey || isComposingEvent(event)) return\n\n          const openOnKeyPress = state.context.openOnKeyPress\n          const isModifierKey = event.ctrlKey || event.metaKey || event.shiftKey\n          const keypress = true\n\n          const keymap: EventKeyMap = {\n            ArrowDown(event) {\n              if (!openOnKeyPress && !open) return\n              send({ type: event.altKey ? \"OPEN\" : \"INPUT.ARROW_DOWN\", keypress })\n              event.preventDefault()\n            },\n            ArrowUp() {\n              if (!openOnKeyPress && !open) return\n              send({ type: event.altKey ? \"CLOSE\" : \"INPUT.ARROW_UP\", keypress })\n              event.preventDefault()\n            },\n            Home(event) {\n              if (isModifierKey) return\n              send({ type: \"INPUT.HOME\", keypress })\n              if (open) {\n                event.preventDefault()\n              }\n            },\n            End(event) {\n              if (isModifierKey) return\n              send({ type: \"INPUT.END\", keypress })\n              if (open) {\n                event.preventDefault()\n              }\n            },\n            Enter(event) {\n              send({ type: \"INPUT.ENTER\", keypress })\n              if (open) {\n                event.preventDefault()\n              }\n              const itemEl = dom.getHighlightedItemEl(state.context)\n              clickIfLink(itemEl)\n            },\n            Escape() {\n              send({ type: \"INPUT.ESCAPE\", keypress })\n              event.preventDefault()\n            },\n          }\n\n          const key = getEventKey(event, state.context)\n          const exec = keymap[key]\n          exec?.(event)\n        },\n      })\n    },\n\n    getTriggerProps(props = {}) {\n      return normalize.button({\n        ...parts.trigger.attrs,\n        dir: state.context.dir,\n        id: dom.getTriggerId(state.context),\n        \"aria-haspopup\": composite ? \"listbox\" : \"dialog\",\n        type: \"button\",\n        tabIndex: props.focusable ? undefined : -1,\n        \"aria-label\": translations.triggerLabel,\n        \"aria-expanded\": open,\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"aria-controls\": open ? dom.getContentId(state.context) : undefined,\n        disabled,\n        \"data-invalid\": dataAttr(invalid),\n        \"data-focusable\": dataAttr(props.focusable),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-disabled\": dataAttr(disabled),\n        onFocus() {\n          if (!props.focusable) return\n          send({ type: \"INPUT.FOCUS\", src: \"trigger\" })\n        },\n        onClick(event) {\n          if (event.defaultPrevented) return\n          if (!interactive) return\n          if (!isLeftClick(event)) return\n          send(\"TRIGGER.CLICK\")\n        },\n        onPointerDown(event) {\n          if (!interactive) return\n          if (event.pointerType === \"touch\") return\n          event.preventDefault()\n          queueMicrotask(() => {\n            dom.getInputEl(state.context)?.focus({ preventScroll: true })\n          })\n        },\n        onKeyDown(event) {\n          if (event.defaultPrevented) return\n          if (composite) return\n\n          const keyMap: EventKeyMap = {\n            ArrowDown() {\n              send({ type: \"INPUT.ARROW_DOWN\", src: \"trigger\" })\n            },\n            ArrowUp() {\n              send({ type: \"INPUT.ARROW_UP\", src: \"trigger\" })\n            },\n          }\n\n          const key = getEventKey(event, state.context)\n          const exec = keyMap[key]\n\n          if (exec) {\n            exec(event)\n            event.preventDefault()\n          }\n        },\n      })\n    },\n\n    getContentProps() {\n      return normalize.element({\n        ...parts.content.attrs,\n        dir: state.context.dir,\n        id: dom.getContentId(state.context),\n        role: !composite ? \"dialog\" : \"listbox\",\n        tabIndex: -1,\n        hidden: !open,\n        \"data-state\": open ? \"open\" : \"closed\",\n        \"data-placement\": state.context.currentPlacement,\n        \"aria-labelledby\": dom.getLabelId(state.context),\n        \"aria-multiselectable\": state.context.multiple && composite ? true : undefined,\n        onPointerDown(event) {\n          // prevent options or elements within listbox from taking focus\n          event.preventDefault()\n        },\n      })\n    },\n\n    getListProps() {\n      return normalize.element({\n        ...parts.list.attrs,\n        role: !composite ? \"listbox\" : undefined,\n        \"aria-labelledby\": dom.getLabelId(state.context),\n        \"aria-multiselectable\": state.context.multiple && !composite ? true : undefined,\n      })\n    },\n\n    getClearTriggerProps() {\n      return normalize.button({\n        ...parts.clearTrigger.attrs,\n        dir: state.context.dir,\n        id: dom.getClearTriggerId(state.context),\n        type: \"button\",\n        tabIndex: -1,\n        disabled: disabled,\n        \"data-invalid\": dataAttr(invalid),\n        \"aria-label\": translations.clearTriggerLabel,\n        \"aria-controls\": dom.getInputId(state.context),\n        hidden: !state.context.value.length,\n        onPointerDown(event) {\n          event.preventDefault()\n        },\n        onClick(event) {\n          if (event.defaultPrevented) return\n          if (!interactive) return\n          send({ type: \"VALUE.CLEAR\", src: \"clear-trigger\" })\n        },\n      })\n    },\n\n    getItemState,\n\n    getItemProps(props) {\n      const itemState = getItemState(props)\n      const value = itemState.value\n\n      return normalize.element({\n        ...parts.item.attrs,\n        dir: state.context.dir,\n        id: dom.getItemId(state.context, value),\n        role: \"option\",\n        tabIndex: -1,\n        \"data-highlighted\": dataAttr(itemState.highlighted),\n        \"data-state\": itemState.selected ? \"checked\" : \"unchecked\",\n        \"aria-selected\": ariaAttr(itemState.highlighted),\n        \"aria-disabled\": ariaAttr(itemState.disabled),\n        \"data-disabled\": dataAttr(itemState.disabled),\n        \"data-value\": itemState.value,\n        onPointerMove() {\n          if (itemState.disabled) return\n          if (itemState.highlighted) return\n          send({ type: \"ITEM.POINTER_MOVE\", value })\n        },\n        onPointerLeave() {\n          if (props.persistFocus) return\n          if (itemState.disabled) return\n          const mouseMoved = state.previousEvent.type.includes(\"POINTER\")\n          if (!mouseMoved) return\n          send({ type: \"ITEM.POINTER_LEAVE\", value })\n        },\n        onClick(event) {\n          if (isDownloadingEvent(event)) return\n          if (isOpeningInNewTab(event)) return\n          if (isContextMenuEvent(event)) return\n          if (itemState.disabled) return\n          send({ type: \"ITEM.CLICK\", src: \"click\", value })\n        },\n      })\n    },\n\n    getItemTextProps(props) {\n      const itemState = getItemState(props)\n      return normalize.element({\n        ...parts.itemText.attrs,\n        dir: state.context.dir,\n        \"data-state\": itemState.selected ? \"checked\" : \"unchecked\",\n        \"data-disabled\": dataAttr(itemState.disabled),\n        \"data-highlighted\": dataAttr(itemState.highlighted),\n      })\n    },\n    getItemIndicatorProps(props) {\n      const itemState = getItemState(props)\n      return normalize.element({\n        \"aria-hidden\": true,\n        ...parts.itemIndicator.attrs,\n        dir: state.context.dir,\n        \"data-state\": itemState.selected ? \"checked\" : \"unchecked\",\n        hidden: !itemState.selected,\n      })\n    },\n\n    getItemGroupProps(props) {\n      const { id } = props\n      return normalize.element({\n        ...parts.itemGroup.attrs,\n        dir: state.context.dir,\n        id: dom.getItemGroupId(state.context, id),\n        \"aria-labelledby\": dom.getItemGroupLabelId(state.context, id),\n      })\n    },\n\n    getItemGroupLabelProps(props) {\n      const { htmlFor } = props\n      return normalize.element({\n        ...parts.itemGroupLabel.attrs,\n        dir: state.context.dir,\n        id: dom.getItemGroupLabelId(state.context, htmlFor),\n        role: \"group\",\n      })\n    },\n  }\n}\n","import { createScope, query } from \"@zag-js/dom-query\"\nimport type { MachineContext as Ctx } from \"./combobox.types\"\n\nexport const dom = createScope({\n  getRootId: (ctx: Ctx) => ctx.ids?.root ?? `combobox:${ctx.id}`,\n  getLabelId: (ctx: Ctx) => ctx.ids?.label ?? `combobox:${ctx.id}:label`,\n  getControlId: (ctx: Ctx) => ctx.ids?.control ?? `combobox:${ctx.id}:control`,\n  getInputId: (ctx: Ctx) => ctx.ids?.input ?? `combobox:${ctx.id}:input`,\n  getContentId: (ctx: Ctx) => ctx.ids?.content ?? `combobox:${ctx.id}:content`,\n  getPositionerId: (ctx: Ctx) => ctx.ids?.positioner ?? `combobox:${ctx.id}:popper`,\n  getTriggerId: (ctx: Ctx) => ctx.ids?.trigger ?? `combobox:${ctx.id}:toggle-btn`,\n  getClearTriggerId: (ctx: Ctx) => ctx.ids?.clearTrigger ?? `combobox:${ctx.id}:clear-btn`,\n  getItemGroupId: (ctx: Ctx, id: string | number) => ctx.ids?.itemGroup?.(id) ?? `combobox:${ctx.id}:optgroup:${id}`,\n  getItemGroupLabelId: (ctx: Ctx, id: string | number) =>\n    ctx.ids?.itemGroupLabel?.(id) ?? `combobox:${ctx.id}:optgroup-label:${id}`,\n  getItemId: (ctx: Ctx, id: string) => ctx.ids?.item?.(id) ?? `combobox:${ctx.id}:option:${id}`,\n\n  getContentEl: (ctx: Ctx) => dom.getById(ctx, dom.getContentId(ctx)),\n  getInputEl: (ctx: Ctx) => dom.getById<HTMLInputElement>(ctx, dom.getInputId(ctx)),\n  getPositionerEl: (ctx: Ctx) => dom.getById(ctx, dom.getPositionerId(ctx)),\n  getControlEl: (ctx: Ctx) => dom.getById(ctx, dom.getControlId(ctx)),\n  getTriggerEl: (ctx: Ctx) => dom.getById(ctx, dom.getTriggerId(ctx)),\n  getClearTriggerEl: (ctx: Ctx) => dom.getById(ctx, dom.getClearTriggerId(ctx)),\n  getHighlightedItemEl: (ctx: Ctx) => {\n    const value = ctx.highlightedValue\n    if (value == null) return\n    const selector = `[role=option][data-value=\"${CSS.escape(value)}\"`\n    return query(dom.getContentEl(ctx), selector)\n  },\n\n  focusInputEl: (ctx: Ctx) => {\n    const inputEl = dom.getInputEl(ctx)\n    if (dom.isActiveElement(ctx, inputEl)) return\n    inputEl?.focus({ preventScroll: true })\n  },\n  focusTriggerEl: (ctx: Ctx) => {\n    const triggerEl = dom.getTriggerEl(ctx)\n    if (dom.isActiveElement(ctx, triggerEl)) return\n    triggerEl?.focus({ preventScroll: true })\n  },\n})\n","import { ariaHidden } from \"@zag-js/aria-hidden\"\nimport { createMachine, guards } from \"@zag-js/core\"\nimport { trackDismissableElement } from \"@zag-js/dismissable\"\nimport { observeAttributes, observeChildren, raf, scrollIntoView } from \"@zag-js/dom-query\"\nimport { getPlacement } from \"@zag-js/popper\"\nimport { addOrRemove, compact, isArray, isBoolean, isEqual, match } from \"@zag-js/utils\"\nimport { collection } from \"./combobox.collection\"\nimport { dom } from \"./combobox.dom\"\nimport type { CollectionItem, MachineContext, MachineState, UserDefinedContext } from \"./combobox.types\"\n\nconst { and, not } = guards\n\nexport function machine<T extends CollectionItem>(userContext: UserDefinedContext<T>) {\n  const ctx = compact(userContext)\n  return createMachine<MachineContext, MachineState>(\n    {\n      id: \"combobox\",\n      initial: ctx.open ? \"suggesting\" : \"idle\",\n      context: {\n        loopFocus: true,\n        openOnClick: false,\n        value: [],\n        highlightedValue: null,\n        inputValue: \"\",\n        allowCustomValue: false,\n        closeOnSelect: !ctx.multiple,\n        inputBehavior: \"none\",\n        selectionBehavior: \"replace\",\n        openOnKeyPress: true,\n        openOnChange: true,\n        composite: true,\n        readOnly: false,\n        disabled: false,\n        ...ctx,\n        highlightedItem: null,\n        selectedItems: [],\n        valueAsString: \"\",\n        collection: ctx.collection ?? collection.empty(),\n        positioning: {\n          placement: \"bottom\",\n          flip: false,\n          sameWidth: true,\n          ...ctx.positioning,\n        },\n        translations: {\n          triggerLabel: \"Toggle suggestions\",\n          clearTriggerLabel: \"Clear value\",\n          ...ctx.translations,\n        },\n      },\n\n      created: [\"syncInitialValues\", \"syncSelectionBehavior\"],\n\n      computed: {\n        isInputValueEmpty: (ctx) => ctx.inputValue.length === 0,\n        isInteractive: (ctx) => !(ctx.readOnly || ctx.disabled),\n        autoComplete: (ctx) => ctx.inputBehavior === \"autocomplete\",\n        autoHighlight: (ctx) => ctx.inputBehavior === \"autohighlight\",\n        hasSelectedItems: (ctx) => ctx.value.length > 0,\n      },\n\n      watch: {\n        value: [\"syncSelectedItems\"],\n        inputValue: [\"syncInputValue\"],\n        highlightedValue: [\"syncHighlightedItem\", \"autofillInputValue\"],\n        multiple: [\"syncSelectionBehavior\"],\n        open: [\"toggleVisibility\"],\n      },\n\n      on: {\n        \"HIGHLIGHTED_VALUE.SET\": {\n          actions: [\"setHighlightedItem\"],\n        },\n        \"ITEM.SELECT\": {\n          actions: [\"selectItem\"],\n        },\n        \"ITEM.CLEAR\": {\n          actions: [\"clearItem\"],\n        },\n        \"VALUE.SET\": {\n          actions: [\"setSelectedItems\"],\n        },\n        \"INPUT_VALUE.SET\": {\n          actions: \"setInputValue\",\n        },\n        \"COLLECTION.SET\": {\n          actions: [\"setCollection\"],\n        },\n        \"POSITIONING.SET\": {\n          actions: [\"reposition\"],\n        },\n      },\n\n      states: {\n        idle: {\n          tags: [\"idle\", \"closed\"],\n          entry: [\"scrollContentToTop\", \"clearHighlightedItem\"],\n          on: {\n            \"CONTROLLED.OPEN\": {\n              target: \"interacting\",\n            },\n            \"TRIGGER.CLICK\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n            ],\n            \"INPUT.CLICK\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n            ],\n            \"INPUT.FOCUS\": {\n              target: \"focused\",\n            },\n            OPEN: [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"invokeOnOpen\"],\n              },\n            ],\n            \"VALUE.CLEAR\": {\n              target: \"focused\",\n              actions: [\"clearInputValue\", \"clearSelectedItems\", \"setInitialFocus\"],\n            },\n          },\n        },\n\n        focused: {\n          tags: [\"focused\", \"closed\"],\n          entry: [\"scrollContentToTop\", \"clearHighlightedItem\"],\n          on: {\n            \"CONTROLLED.OPEN\": [\n              {\n                guard: \"isChangeEvent\",\n                target: \"suggesting\",\n              },\n              {\n                target: \"interacting\",\n              },\n            ],\n            \"INPUT.CHANGE\": [\n              {\n                guard: and(\"isOpenControlled\", \"openOnChange\"),\n                actions: [\"setInputValue\", \"invokeOnOpen\", \"highlightFirstItemIfNeeded\"],\n              },\n              {\n                guard: \"openOnChange\",\n                target: \"suggesting\",\n                actions: [\"setInputValue\", \"invokeOnOpen\", \"highlightFirstItemIfNeeded\"],\n              },\n              {\n                actions: \"setInputValue\",\n              },\n            ],\n            \"LAYER.INTERACT_OUTSIDE\": {\n              target: \"idle\",\n            },\n            \"INPUT.ESCAPE\": {\n              guard: and(\"isCustomValue\", not(\"allowCustomValue\")),\n              actions: \"revertInputValue\",\n            },\n            \"INPUT.BLUR\": {\n              target: \"idle\",\n            },\n            \"INPUT.CLICK\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n            ],\n            \"TRIGGER.CLICK\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"setInitialFocus\", \"highlightFirstSelectedItem\", \"invokeOnOpen\"],\n              },\n            ],\n            \"INPUT.ARROW_DOWN\": [\n              // == group 1 ==\n              {\n                guard: and(\"isOpenControlled\", \"autoComplete\"),\n                actions: [\"invokeOnOpen\"],\n              },\n              {\n                guard: \"autoComplete\",\n                target: \"interacting\",\n                actions: [\"invokeOnOpen\"],\n              },\n              // == group 2 ==\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"highlightFirstOrSelectedItem\", \"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"highlightFirstOrSelectedItem\", \"invokeOnOpen\"],\n              },\n            ],\n            \"INPUT.ARROW_UP\": [\n              // == group 1 ==\n              {\n                guard: \"autoComplete\",\n                target: \"interacting\",\n                actions: \"invokeOnOpen\",\n              },\n              {\n                guard: \"autoComplete\",\n                target: \"interacting\",\n                actions: \"invokeOnOpen\",\n              },\n              // == group 2 ==\n              {\n                target: \"interacting\",\n                actions: [\"highlightLastOrSelectedItem\", \"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"highlightLastOrSelectedItem\", \"invokeOnOpen\"],\n              },\n            ],\n            OPEN: [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"invokeOnOpen\"],\n              },\n              {\n                target: \"interacting\",\n                actions: [\"invokeOnOpen\"],\n              },\n            ],\n            \"VALUE.CLEAR\": {\n              actions: [\"clearInputValue\", \"clearSelectedItems\"],\n            },\n          },\n        },\n\n        interacting: {\n          tags: [\"open\", \"focused\"],\n          entry: [\"setInitialFocus\"],\n          activities: [\"scrollToHighlightedItem\", \"trackDismissableLayer\", \"computePlacement\", \"hideOtherElements\"],\n          on: {\n            \"CONTROLLED.CLOSE\": [\n              {\n                guard: \"restoreFocus\",\n                target: \"focused\",\n                actions: [\"setFinalFocus\"],\n              },\n              {\n                target: \"idle\",\n              },\n            ],\n            \"INPUT.HOME\": {\n              actions: [\"highlightFirstItem\"],\n            },\n            \"INPUT.END\": {\n              actions: [\"highlightLastItem\"],\n            },\n            \"INPUT.ARROW_DOWN\": [\n              {\n                guard: and(\"autoComplete\", \"isLastItemHighlighted\"),\n                actions: [\"clearHighlightedItem\", \"scrollContentToTop\"],\n              },\n              {\n                actions: [\"highlightNextItem\"],\n              },\n            ],\n            \"INPUT.ARROW_UP\": [\n              {\n                guard: and(\"autoComplete\", \"isFirstItemHighlighted\"),\n                actions: \"clearHighlightedItem\",\n              },\n              {\n                actions: \"highlightPrevItem\",\n              },\n            ],\n            \"INPUT.ENTER\": [\n              {\n                guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n                actions: [\"selectHighlightedItem\", \"invokeOnClose\"],\n              },\n              {\n                guard: \"closeOnSelect\",\n                target: \"focused\",\n                actions: [\"selectHighlightedItem\", \"invokeOnClose\", \"setFinalFocus\"],\n              },\n              {\n                actions: [\"selectHighlightedItem\"],\n              },\n            ],\n            \"INPUT.CHANGE\": [\n              {\n                guard: \"autoComplete\",\n                target: \"suggesting\",\n                actions: [\"setInputValue\", \"invokeOnOpen\"],\n              },\n              {\n                target: \"suggesting\",\n                actions: [\"clearHighlightedItem\", \"setInputValue\", \"invokeOnOpen\"],\n              },\n            ],\n            \"ITEM.POINTER_MOVE\": {\n              actions: [\"setHighlightedItem\"],\n            },\n            \"ITEM.POINTER_LEAVE\": {\n              actions: [\"clearHighlightedItem\"],\n            },\n            \"ITEM.CLICK\": [\n              {\n                guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n                actions: [\"selectItem\", \"invokeOnClose\"],\n              },\n              {\n                guard: \"closeOnSelect\",\n                target: \"focused\",\n                actions: [\"selectItem\", \"invokeOnClose\", \"setFinalFocus\"],\n              },\n              {\n                actions: [\"selectItem\"],\n              },\n            ],\n            \"LAYER.ESCAPE\": [\n              {\n                guard: and(\"isOpenControlled\", \"autoComplete\"),\n                actions: [\"syncInputValue\", \"invokeOnClose\"],\n              },\n              {\n                guard: \"autoComplete\",\n                target: \"focused\",\n                actions: [\"syncInputValue\", \"invokeOnClose\"],\n              },\n              {\n                guard: \"isOpenControlled\",\n                actions: \"invokeOnClose\",\n              },\n              {\n                target: \"focused\",\n                actions: [\"invokeOnClose\", \"setFinalFocus\"],\n              },\n            ],\n            \"TRIGGER.CLICK\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: \"invokeOnClose\",\n              },\n              {\n                target: \"focused\",\n                actions: \"invokeOnClose\",\n              },\n            ],\n            \"LAYER.INTERACT_OUTSIDE\": [\n              // == group 1 ==\n              {\n                guard: and(\"isOpenControlled\", \"isCustomValue\", not(\"allowCustomValue\")),\n                actions: [\"revertInputValue\", \"invokeOnClose\"],\n              },\n              {\n                guard: and(\"isCustomValue\", not(\"allowCustomValue\")),\n                target: \"idle\",\n                actions: [\"revertInputValue\", \"invokeOnClose\"],\n              },\n              // == group 2 ==\n              {\n                guard: \"isOpenControlled\",\n                actions: \"invokeOnClose\",\n              },\n              {\n                target: \"idle\",\n                actions: \"invokeOnClose\",\n              },\n            ],\n            CLOSE: [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"invokeOnClose\"],\n              },\n              {\n                target: \"focused\",\n                actions: [\"invokeOnClose\", \"setFinalFocus\"],\n              },\n            ],\n            \"VALUE.CLEAR\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\"],\n              },\n              {\n                target: \"focused\",\n                actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\", \"setFinalFocus\"],\n              },\n            ],\n          },\n        },\n\n        suggesting: {\n          tags: [\"open\", \"focused\"],\n          activities: [\n            \"trackDismissableLayer\",\n            \"scrollToHighlightedItem\",\n            \"computePlacement\",\n            \"trackChildNodes\",\n            \"hideOtherElements\",\n          ],\n          entry: [\"setInitialFocus\"],\n          on: {\n            \"CONTROLLED.CLOSE\": [\n              {\n                guard: \"restoreFocus\",\n                target: \"focused\",\n                actions: [\"setFinalFocus\"],\n              },\n              {\n                target: \"idle\",\n              },\n            ],\n            CHILDREN_CHANGE: {\n              actions: [\"highlightFirstItem\"],\n            },\n            \"INPUT.ARROW_DOWN\": {\n              target: \"interacting\",\n              actions: [\"highlightNextItem\"],\n            },\n            \"INPUT.ARROW_UP\": {\n              target: \"interacting\",\n              actions: [\"highlightPrevItem\"],\n            },\n            \"INPUT.HOME\": {\n              target: \"interacting\",\n              actions: [\"highlightFirstItem\"],\n            },\n            \"INPUT.END\": {\n              target: \"interacting\",\n              actions: [\"highlightLastItem\"],\n            },\n            \"INPUT.ENTER\": [\n              {\n                guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n                actions: [\"selectHighlightedItem\", \"invokeOnClose\"],\n              },\n              {\n                guard: \"closeOnSelect\",\n                target: \"focused\",\n                actions: [\"selectHighlightedItem\", \"invokeOnClose\", \"setFinalFocus\"],\n              },\n              {\n                actions: [\"selectHighlightedItem\"],\n              },\n            ],\n            \"INPUT.CHANGE\": [\n              {\n                guard: \"autoHighlight\",\n                actions: [\"setInputValue\"],\n              },\n              {\n                actions: [\"setInputValue\"],\n              },\n            ],\n            \"LAYER.ESCAPE\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"invokeOnClose\"],\n              },\n              {\n                target: \"focused\",\n                actions: [\"invokeOnClose\"],\n              },\n            ],\n            \"ITEM.POINTER_MOVE\": {\n              target: \"interacting\",\n              actions: [\"setHighlightedItem\"],\n            },\n            \"ITEM.POINTER_LEAVE\": {\n              actions: [\"clearHighlightedItem\"],\n            },\n            \"LAYER.INTERACT_OUTSIDE\": [\n              // == group 1 ==\n              {\n                guard: and(\"isOpenControlled\", \"isCustomValue\", not(\"allowCustomValue\")),\n                actions: [\"revertInputValue\", \"invokeOnClose\"],\n              },\n              {\n                guard: and(\"isCustomValue\", not(\"allowCustomValue\")),\n                target: \"idle\",\n                actions: [\"revertInputValue\", \"invokeOnClose\"],\n              },\n              // == group 2 ==\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"invokeOnClose\"],\n              },\n              {\n                target: \"idle\",\n                actions: [\"invokeOnClose\"],\n              },\n            ],\n            \"TRIGGER.CLICK\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"invokeOnClose\"],\n              },\n              {\n                target: \"focused\",\n                actions: [\"invokeOnClose\"],\n              },\n            ],\n            \"ITEM.CLICK\": [\n              {\n                guard: and(\"isOpenControlled\", \"closeOnSelect\"),\n                actions: [\"selectItem\", \"invokeOnClose\"],\n              },\n              {\n                guard: \"closeOnSelect\",\n                target: \"focused\",\n                actions: [\"selectItem\", \"invokeOnClose\", \"setFinalFocus\"],\n              },\n              {\n                actions: [\"selectItem\"],\n              },\n            ],\n            CLOSE: [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"invokeOnClose\"],\n              },\n              {\n                target: \"focused\",\n                actions: [\"invokeOnClose\", \"setFinalFocus\"],\n              },\n            ],\n            \"VALUE.CLEAR\": [\n              {\n                guard: \"isOpenControlled\",\n                actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\"],\n              },\n              {\n                target: \"focused\",\n                actions: [\"clearInputValue\", \"clearSelectedItems\", \"invokeOnClose\", \"setFinalFocus\"],\n              },\n            ],\n          },\n        },\n      },\n    },\n\n    {\n      guards: {\n        isInputValueEmpty: (ctx) => ctx.isInputValueEmpty,\n        autoComplete: (ctx) => ctx.autoComplete && !ctx.multiple,\n        autoHighlight: (ctx) => ctx.autoHighlight,\n        isFirstItemHighlighted: (ctx) => ctx.collection.firstValue === ctx.highlightedValue,\n        isLastItemHighlighted: (ctx) => ctx.collection.lastValue === ctx.highlightedValue,\n        isCustomValue: (ctx) => ctx.inputValue !== ctx.valueAsString,\n        allowCustomValue: (ctx) => !!ctx.allowCustomValue,\n        hasHighlightedItem: (ctx) => ctx.highlightedValue != null,\n        closeOnSelect: (ctx) => !!ctx.closeOnSelect,\n        isOpenControlled: (ctx) => !!ctx[\"open.controlled\"],\n        openOnChange: (ctx, evt) => {\n          if (isBoolean(ctx.openOnChange)) return ctx.openOnChange\n          return !!ctx.openOnChange?.({ inputValue: evt.value })\n        },\n        restoreFocus: (_ctx, evt) => (evt.restoreFocus == null ? true : !!evt.restoreFocus),\n        isChangeEvent: (_ctx, evt) => evt.previousEvent?.type === \"INPUT.CHANGE\",\n      },\n\n      activities: {\n        trackDismissableLayer(ctx, _evt, { send }) {\n          if (ctx.disableLayer) return\n          const contentEl = () => dom.getContentEl(ctx)\n          return trackDismissableElement(contentEl, {\n            defer: true,\n            exclude: () => [dom.getInputEl(ctx), dom.getTriggerEl(ctx), dom.getClearTriggerEl(ctx)],\n            onFocusOutside: ctx.onFocusOutside,\n            onPointerDownOutside: ctx.onPointerDownOutside,\n            onInteractOutside: ctx.onInteractOutside,\n            onEscapeKeyDown(event) {\n              event.preventDefault()\n              event.stopPropagation()\n              send(\"LAYER.ESCAPE\")\n            },\n            onDismiss() {\n              send({ type: \"LAYER.INTERACT_OUTSIDE\", restoreFocus: false })\n            },\n          })\n        },\n        hideOtherElements(ctx) {\n          return ariaHidden([dom.getInputEl(ctx), dom.getContentEl(ctx), dom.getTriggerEl(ctx)])\n        },\n        computePlacement(ctx) {\n          const controlEl = () => dom.getControlEl(ctx)\n          const positionerEl = () => dom.getPositionerEl(ctx)\n          ctx.currentPlacement = ctx.positioning.placement\n          return getPlacement(controlEl, positionerEl, {\n            ...ctx.positioning,\n            defer: true,\n            onComplete(data) {\n              ctx.currentPlacement = data.placement\n            },\n          })\n        },\n        // in event the options are fetched (async), we still want to auto-highlight the first option\n        trackChildNodes(ctx, _evt, { send }) {\n          if (!ctx.autoHighlight) return\n          const exec = () => send(\"CHILDREN_CHANGE\")\n          const contentEl = () => dom.getContentEl(ctx)\n          return observeChildren(contentEl, {\n            callback: exec,\n            defer: true,\n          })\n        },\n        scrollToHighlightedItem(ctx, _evt, { getState }) {\n          const inputEl = dom.getInputEl(ctx)\n\n          let cleanups: VoidFunction[] = []\n\n          const exec = (immediate: boolean) => {\n            const state = getState()\n\n            const pointer = state.event.type.includes(\"POINTER\")\n            if (pointer || !ctx.highlightedValue) return\n\n            const itemEl = dom.getHighlightedItemEl(ctx)\n            const contentEl = dom.getContentEl(ctx)\n\n            if (ctx.scrollToIndexFn) {\n              const highlightedIndex = ctx.collection.indexOf(ctx.highlightedValue)\n              ctx.scrollToIndexFn({ index: highlightedIndex, immediate })\n              return\n            }\n\n            const rafCleanup = raf(() => {\n              scrollIntoView(itemEl, { rootEl: contentEl, block: \"nearest\" })\n            })\n            cleanups.push(rafCleanup)\n          }\n\n          const rafCleanup = raf(() => exec(true))\n          cleanups.push(rafCleanup)\n\n          const observerCleanup = observeAttributes(inputEl, {\n            attributes: [\"aria-activedescendant\"],\n            callback: () => exec(false),\n          })\n          cleanups.push(observerCleanup)\n\n          return () => {\n            cleanups.forEach((cleanup) => cleanup())\n          }\n        },\n      },\n\n      actions: {\n        reposition(ctx, evt) {\n          const controlEl = () => dom.getControlEl(ctx)\n          const positionerEl = () => dom.getPositionerEl(ctx)\n          getPlacement(controlEl, positionerEl, {\n            ...ctx.positioning,\n            ...evt.options,\n            defer: true,\n            listeners: false,\n            onComplete(data) {\n              ctx.currentPlacement = data.placement\n            },\n          })\n        },\n        setHighlightedItem(ctx, evt) {\n          if (evt.value == null) return\n          set.highlightedValue(ctx, evt.value)\n        },\n        clearHighlightedItem(ctx) {\n          set.highlightedValue(ctx, null, true)\n        },\n        selectHighlightedItem(ctx) {\n          set.value(ctx, ctx.highlightedValue)\n        },\n        selectItem(ctx, evt) {\n          if (evt.value == null) return\n          set.value(ctx, evt.value)\n        },\n        clearItem(ctx, evt) {\n          if (evt.value == null) return\n          const value = ctx.value.filter((v) => v !== evt.value)\n          set.value(ctx, value)\n        },\n        setInitialFocus(ctx) {\n          raf(() => {\n            dom.focusInputEl(ctx)\n          })\n        },\n        setFinalFocus(ctx) {\n          raf(() => {\n            const triggerEl = dom.getTriggerEl(ctx)\n            if (triggerEl?.dataset.focusable == null) {\n              dom.focusInputEl(ctx)\n            } else {\n              dom.focusTriggerEl(ctx)\n            }\n          })\n        },\n        syncInputValue(ctx) {\n          const inputEl = dom.getInputEl(ctx)\n          if (!inputEl) return\n\n          inputEl.value = ctx.inputValue\n\n          queueMicrotask(() => {\n            const { selectionStart, selectionEnd } = inputEl\n\n            if (Math.abs((selectionEnd ?? 0) - (selectionStart ?? 0)) !== 0) return\n            if (selectionStart !== 0) return\n\n            inputEl.setSelectionRange(inputEl.value.length, inputEl.value.length)\n          })\n        },\n        setInputValue(ctx, evt) {\n          set.inputValue(ctx, evt.value)\n        },\n        clearInputValue(ctx) {\n          set.inputValue(ctx, \"\")\n        },\n        revertInputValue(ctx) {\n          const inputValue = match(ctx.selectionBehavior, {\n            replace: ctx.hasSelectedItems ? ctx.valueAsString : \"\",\n            preserve: ctx.inputValue,\n            clear: \"\",\n          })\n\n          set.inputValue(ctx, inputValue)\n        },\n        syncInitialValues(ctx) {\n          const selectedItems = ctx.collection.findMany(ctx.value)\n          const valueAsString = ctx.collection.stringifyMany(ctx.value)\n\n          ctx.highlightedItem = ctx.collection.find(ctx.highlightedValue)\n          ctx.selectedItems = selectedItems\n          ctx.valueAsString = valueAsString\n\n          if (ctx.inputValue.trim() || ctx.multiple) return\n\n          ctx.inputValue = match(ctx.selectionBehavior, {\n            preserve: ctx.inputValue || valueAsString,\n            replace: valueAsString,\n            clear: \"\",\n          })\n        },\n        syncSelectionBehavior(ctx) {\n          if (ctx.multiple) {\n            ctx.selectionBehavior = \"clear\"\n          }\n        },\n        setSelectedItems(ctx, evt) {\n          if (!isArray(evt.value)) return\n          set.value(ctx, evt.value)\n        },\n        clearSelectedItems(ctx) {\n          set.value(ctx, [])\n        },\n        scrollContentToTop(ctx) {\n          if (ctx.scrollToIndexFn) {\n            ctx.scrollToIndexFn({ index: 0, immediate: true })\n          } else {\n            const contentEl = dom.getContentEl(ctx)\n            if (!contentEl) return\n            contentEl.scrollTop = 0\n          }\n        },\n        invokeOnOpen(ctx) {\n          ctx.onOpenChange?.({ open: true })\n        },\n        invokeOnClose(ctx) {\n          ctx.onOpenChange?.({ open: false })\n        },\n        highlightFirstItem(ctx) {\n          raf(() => {\n            const value = ctx.collection.firstValue\n            set.highlightedValue(ctx, value)\n          })\n        },\n        highlightFirstItemIfNeeded(ctx) {\n          if (!ctx.autoHighlight) return\n          raf(() => {\n            const value = ctx.collection.firstValue\n            set.highlightedValue(ctx, value)\n          })\n        },\n        highlightLastItem(ctx) {\n          raf(() => {\n            const value = ctx.collection.lastValue\n            set.highlightedValue(ctx, value)\n          })\n        },\n        highlightNextItem(ctx) {\n          let value: string | null = null\n          if (ctx.highlightedValue) {\n            value = ctx.collection.getNextValue(ctx.highlightedValue)\n            if (!value && ctx.loopFocus) value = ctx.collection.firstValue\n          } else {\n            value = ctx.collection.firstValue\n          }\n          set.highlightedValue(ctx, value)\n        },\n        highlightPrevItem(ctx) {\n          let value: string | null = null\n          if (ctx.highlightedValue) {\n            value = ctx.collection.getPreviousValue(ctx.highlightedValue)\n            if (!value && ctx.loopFocus) value = ctx.collection.lastValue\n          } else {\n            value = ctx.collection.lastValue\n          }\n          set.highlightedValue(ctx, value)\n        },\n        highlightFirstSelectedItem(ctx) {\n          raf(() => {\n            const [value] = ctx.collection.sort(ctx.value)\n            set.highlightedValue(ctx, value)\n          })\n        },\n        highlightFirstOrSelectedItem(ctx) {\n          raf(() => {\n            let value: string | null = null\n            if (ctx.hasSelectedItems) {\n              value = ctx.collection.sort(ctx.value)[0]\n            } else {\n              value = ctx.collection.firstValue\n            }\n            set.highlightedValue(ctx, value)\n          })\n        },\n        highlightLastOrSelectedItem(ctx) {\n          raf(() => {\n            let value: string | null = null\n            if (ctx.hasSelectedItems) {\n              value = ctx.collection.sort(ctx.value)[0]\n            } else {\n              value = ctx.collection.lastValue\n            }\n            set.highlightedValue(ctx, value)\n          })\n        },\n        autofillInputValue(ctx, evt) {\n          const inputEl = dom.getInputEl(ctx)\n          if (!ctx.autoComplete || !inputEl || !evt.keypress) return\n          const valueText = ctx.collection.stringify(ctx.highlightedValue)\n          raf(() => {\n            inputEl.value = valueText || ctx.inputValue\n          })\n        },\n        setCollection(ctx, evt) {\n          ctx.collection = evt.value\n        },\n        syncSelectedItems(ctx) {\n          sync.valueChange(ctx)\n        },\n        syncHighlightedItem(ctx) {\n          sync.highlightChange(ctx)\n        },\n        toggleVisibility(ctx, evt, { send }) {\n          send({ type: ctx.open ? \"CONTROLLED.OPEN\" : \"CONTROLLED.CLOSE\", previousEvent: evt })\n        },\n      },\n    },\n  )\n}\n\nconst sync = {\n  valueChange: (ctx: MachineContext) => {\n    // side effect\n    const prevSelectedItems = ctx.selectedItems\n\n    ctx.selectedItems = ctx.value.map((v) => {\n      const foundItem = prevSelectedItems.find((item) => ctx.collection.getItemValue(item) === v)\n      if (foundItem) return foundItem\n      return ctx.collection.find(v)\n    })\n\n    const valueAsString = ctx.collection.stringifyItems(ctx.selectedItems)\n    ctx.valueAsString = valueAsString\n\n    // set inputValue\n    let inputValue: string | undefined\n    if (ctx.getSelectionValue) {\n      //\n      inputValue = ctx.getSelectionValue({\n        inputValue: ctx.inputValue,\n        selectedItems: Array.from(ctx.selectedItems),\n        valueAsString,\n      })\n      //\n    } else {\n      //\n      inputValue = match(ctx.selectionBehavior, {\n        replace: ctx.valueAsString,\n        preserve: ctx.inputValue,\n        clear: \"\",\n      })\n    }\n\n    set.inputValue(ctx, inputValue)\n  },\n  highlightChange: (ctx: MachineContext) => {\n    ctx.highlightedItem = ctx.collection.find(ctx.highlightedValue)\n  },\n}\n\nconst invoke = {\n  valueChange: (ctx: MachineContext) => {\n    sync.valueChange(ctx)\n    ctx.onValueChange?.({\n      value: Array.from(ctx.value),\n      items: Array.from(ctx.selectedItems),\n    })\n  },\n  highlightChange: (ctx: MachineContext) => {\n    sync.highlightChange(ctx)\n    ctx.onHighlightChange?.({\n      highlightedValue: ctx.highlightedValue,\n      highlightedItem: ctx.highlightedItem,\n    })\n  },\n  inputChange: (ctx: MachineContext) => {\n    ctx.onInputValueChange?.({ inputValue: ctx.inputValue })\n  },\n}\n\nconst set = {\n  value: (ctx: MachineContext, value: string | string[] | null | undefined, force = false) => {\n    if (isEqual(ctx.value, value)) return\n    if (value == null && !force) return\n    if (value == null && force) {\n      ctx.value = []\n      invoke.valueChange(ctx)\n      return\n    }\n    if (isArray(value)) {\n      ctx.value = value\n    } else if (value != null) {\n      ctx.value = ctx.multiple ? addOrRemove(ctx.value, value) : [value]\n    }\n    invoke.valueChange(ctx)\n  },\n  highlightedValue: (ctx: MachineContext, value: string | null | undefined, force = false) => {\n    if (isEqual(ctx.highlightedValue, value)) return\n    if (!value && !force) return\n    ctx.highlightedValue = value || null\n    invoke.highlightChange(ctx)\n  },\n  inputValue: (ctx: MachineContext, value: string) => {\n    if (isEqual(ctx.inputValue, value)) return\n    ctx.inputValue = value\n    invoke.inputChange(ctx)\n  },\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}